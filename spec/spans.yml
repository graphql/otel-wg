groups:
  - id: span.graphql.server
    type: span
    stability: development
    span_kind: server
    brief: >
      This span represents an incoming GraphQL request on a server implementation.
    note: |
      **Span name** SHOULD be of the format `{graphql.operation.type}` provided
      `graphql.operation.type` is available. If `graphql.operation.type` is not available,
      the span SHOULD be named `GraphQL Operation`.

      For operation domains with bounded cardinality (e.g. trusted documents), instrumentations MAY provide
      a configuration option to enable a more descriptive span name following
      the `{graphql.operation.type} {graphql.operation.name}` format when
      `graphql.operation.name` is available and the operation is successfully identified
      in the document.

      > **Warning**
      > The `graphql.operation.name` value is provided by the client and can have high
      > cardinality. Using it in the GraphQL server span name is NOT RECOMMENDED for
      > ad-hoc operations without careful consideration of cardinality implications.
      > For trusted documents, the cardinality is bounded and using the operation
      > name in the span name is more acceptable.
      >
      > Implementations MUST NOT include the operation name in the span name when
      > the operation was not found or could not be identified in the document.
      > This prevents potential security issues and ensures span names remain meaningful.
    attributes:
      - ref: graphql.operation.type
        requirement_level:
          conditionally_required: If parsing succeeded
      - ref: graphql.operation.name
        requirement_level:
          conditionally_required: If available and not empty.
      - ref: graphql.document.hash
        requirement_level: recommended
      - ref: graphql.document.id
        requirement_level:
          conditionally_required: If using persisted operations.

  - id: span.graphql.document.parsing.internal
    type: span
    stability: development
    span_kind: internal
    brief: >
      This span represents the time spent parsing a GraphQL document.
    note: |
      **Span name** SHOULD be `GraphQL Document Parsing`.

      This span covers the parsing phase of GraphQL request processing,
      where the document string is parsed into an abstract syntax tree (AST).
    attributes:
      - ref: graphql.operation.type
        requirement_level:
          conditionally_required: If parsing succeeded
      - ref: graphql.operation.name
        requirement_level:
          conditionally_required: If available and not empty.
      - ref: graphql.document.hash
        requirement_level: recommended
      - ref: graphql.document.id
        requirement_level:
          conditionally_required: If using persisted operations.

  - id: span.graphql.document.validation.internal
    type: span
    stability: development
    span_kind: internal
    brief: >
      This span represents the time spent validating a GraphQL document.
    note: |
      **Span name** SHOULD be `GraphQL Document Validation`.

      This span covers the validation phase of GraphQL request processing,
      where the document AST is validated against the GraphQL schema.
    attributes:
      - ref: graphql.operation.type
        requirement_level: required
      - ref: graphql.operation.name
        requirement_level:
          conditionally_required: If available and not empty.
      - ref: graphql.document.hash
        requirement_level: recommended
      - ref: graphql.document.id
        requirement_level:
          conditionally_required: If using persisted operations.

  - id: span.graphql.document.variable_coercion.internal
    type: span
    stability: development
    span_kind: internal
    brief: >
      This span represents the time spent coercing variables for a GraphQL request.
    note: |
      **Span name** SHOULD be `GraphQL Variable Coercion`.

      This span covers the variable coercion phase of GraphQL request processing,
      where input variables are coerced and validated according to their types.
    attributes:
      - ref: graphql.operation.type
        requirement_level: required
      - ref: graphql.operation.name
        requirement_level:
          conditionally_required: If available and not empty.
      - ref: graphql.document.hash
        requirement_level: recommended
      - ref: graphql.document.id
        requirement_level:
          conditionally_required: If using persisted operations.

  - id: span.graphql.operation.planning.internal
    type: span
    stability: development
    span_kind: internal
    brief: >
      This span represents the time spent planning the execution of a GraphQL operation.
    note: |
      **Span name** SHOULD be `GraphQL Operation Planning`.

      This span covers the operation planning phase of GraphQL request processing,
      where the server analyzes the validated query and creates an execution plan.
      This phase is common in federated GraphQL systems where queries need to be
      planned across multiple sources, and in advanced GraphQL servers that
      perform query optimization and planning.

      Planning typically involves determining execution order, identifying required
      data sources, optimizing data fetching strategies, and preparing the execution
      context.
    attributes:
      - ref: graphql.operation.type
        requirement_level: required
      - ref: graphql.operation.name
        requirement_level: recommended
      - ref: graphql.document.hash
        requirement_level: recommended

  - id: span.graphql.step.execution.internal
    type: span
    stability: development
    span_kind: internal
    brief: >
      This span represents the execution of an individual step within a GraphQL operation execution plan.
    note: |
      **Span name** SHOULD be `GraphQL Step Execution`.

      This span covers the execution of a single step in the GraphQL execution plan,
      where each step typically represents the resolution of one or more fields
      that can be executed together.

      Each step execution may involve field resolution, data fetching from external
      services, data transformation, and result aggregation. Multiple step execution
      spans may run concurrently or sequentially depending on the execution strategy
      and field dependencies.

      The `graphql.step.execution` span SHOULD be a descendant of the
      `graphql.operation.execution` span.

      Some GraphQL implementations (e.g., plan-based engines like Grafast,
      or distributed systems like federation and stitching) replace the classic
      resolver-based execution with a plan-based approach where the operation
      is broken into steps. In this model, the `graphql.operation.execution`
      span still represents the overall execution phase, while `graphql.step.execution`
      spans represent individual units of work within that execution - such as
      data fetching, transformations, or requests to source systems.

      The `graphql.operation.planning` span, when present, MAY also be
      a descendant of `graphql.operation.execution`, depending on whether
      the implementation treats planning as part of the execution phase or as a
      separate preceding phase.
    attributes:
      - ref: graphql.operation.type
        requirement_level: recommended
      - ref: graphql.operation.name
        requirement_level: recommended
      - ref: graphql.document.hash
        requirement_level: recommended
      - ref: graphql.operation.step.id
        requirement_level: required
      - ref: graphql.operation.step.kind
        requirement_level: recommended
      - ref: graphql.operation.step.plan.id
        requirement_level: recommended
      - ref: graphql.source.name
        requirement_level: opt_in
      - ref: graphql.source.id
        requirement_level: opt_in
      - ref: graphql.source.operation.name
        requirement_level: opt_in
      - ref: graphql.source.operation.kind
        requirement_level: opt_in
      - ref: graphql.source.operation.hash
        requirement_level: opt_in

  - id: span.graphql.operation.execution.internal
    type: span
    stability: development
    span_kind: internal
    brief: >
      This span represents the execution phase of a GraphQL operation.
    note: |
      **Span name** SHOULD be `GraphQL Operation Execution`.

      This span covers the whole execution part of a GraphQL request,
      including field resolution and result formatting.
    attributes:
      - ref: graphql.operation.type
        requirement_level: required
      - ref: graphql.operation.name
        requirement_level: recommended
      - ref: graphql.document.hash
        requirement_level: recommended
      - ref: graphql.document.id
        requirement_level:
          conditionally_required: If using persisted operations.

  - id: span.graphql.field.execution.internal
    type: span
    stability: development
    span_kind: internal
    brief: >
      This span represents the execution of a GraphQL field.
    note: |
      **Span name** SHOULD be `{graphql.selection.field.coordinate}`.

      This span covers the execution of an individual field, including both
      synchronous and asynchronous resolvers. The span ends when the resolver
      result is available.

      > **Warning**
      > Creating spans for every resolver execution can result in traces with
      > hundreds or thousands of spans, severely impacting performance and
      > trace readability. Instrumentations MUST NOT create resolver execution
      > spans by default for all resolvers.

      Instrumentations SHOULD provide configuration options to control which
      resolvers generate spans. Recommended strategies include:

      - **Manual selection**: Allow developers to explicitly mark specific
        resolvers for tracing (e.g., via annotations, decorators, or configuration)
      - **Asynchronous resolvers only**: Only trace resolvers that return
        promises or other asynchronous constructs
      - **Depth-based filtering**: Only trace resolvers at the top N levels
        of the query (e.g., top 2 levels)
      - **Performance-based filtering**: Only trace resolvers that exceed
        a certain execution time threshold

      The selection criteria SHOULD be documented clearly for users to
      understand which resolvers will generate spans.
    attributes:
      - ref: graphql.selection.name
        requirement_level: recommended
      - ref: graphql.selection.path
        requirement_level: recommended
      - ref: graphql.selection.field.name
        requirement_level: required
      - ref: graphql.selection.field.parent_type
        requirement_level: required
      - ref: graphql.selection.field.coordinate
        requirement_level: required

  - id: span.graphql.dataloader.dispatch.internal
    type: span
    stability: development
    span_kind: internal
    brief: >
      This optional span groups all DataLoader batch operations for a given request.
    note: |
      **Span name** SHOULD be `GraphQL DataLoader Dispatch`.

      This span is OPTIONAL. When present, it acts as a grouping span for all
      DataLoader batch spans within a single GraphQL request. It represents
      the overall dispatch of DataLoader batch operations.

      The span SHOULD be a child of the `graphql.server` span.

      Instrumentations that do not produce this span SHOULD attach DataLoader
      batch spans directly to the `graphql.server` span or to the
      resolver execution span that triggered the batch dispatch.
    attributes: []

  - id: span.graphql.dataloader.batch.internal
    type: span
    stability: development
    span_kind: internal
    brief: >
      This span represents the execution of a DataLoader batch operation.
    note: |
      **Span name** SHOULD be `GraphQL DataLoader Batch {graphql.dataloader.name}` when
      the DataLoader has a name, otherwise `GraphQL DataLoader Batch`.

      This span covers the batched execution of multiple individual DataLoader
      requests. It represents the time from when the batch is scheduled to
      when all results are available. This span is created when a DataLoader
      batches multiple individual load requests into a single batch operation
      to optimize data access patterns.

      The parent of this span depends on what the instrumentation supports:
      - If the `graphql.dataloader.dispatch` span is present,
        this span SHOULD be a child of it.
      - Otherwise, this span SHOULD be a child of the `graphql.server`
        span, or of the resolver execution span that triggered the batch dispatch.

      The span SHOULD have links to all resolver execution spans that
      contributed load requests to this batch, so that the causal
      relationship between resolvers and the batch is preserved.
    attributes:
      - ref: graphql.dataloader.name
        requirement_level: recommended
      - ref: graphql.dataloader.batch.size
        requirement_level: required
      - ref: graphql.dataloader.batch.keys
        requirement_level: opt_in
      - ref: graphql.dataloader.cache.hit_count
        requirement_level: opt_in
      - ref: graphql.dataloader.cache.miss_count
        requirement_level: opt_in
